/**
    This service is provided as a mock API

    This file is NOT to be modifed
    for ANY reason by applicants!

    DO NOT EDIT THIS FILE
*/
(function MockAPIProvider() {

    "use strict";

    angular
        .module("va.challenge.frontend")
        // Based on https://docs.angularjs.org/api/auto/service/$provide#factory, I assume the next line gives the whole app access to the MockAPI service.
        .factory("MockAPI", MockAPI);

    /** @ngInject */
    function MockAPI(MockDataBrowsers, $q, $timeout) {

        var config = {};

        config.get = getData;

        return config;

        function getData(params) {

            // Clone to avoid binding to `MockData`
            var data = _.chain(MockDataBrowsers).cloneDeep();
            // data is a LodashWrapper.
            // The value of its __wrapped__ property is an array of data.
            var defer = $q.defer();
            var browsers = _.get(params, "browser");

            // If the "browser" param is missing
            // Or if the "browser" param length is equal to the amount of avaiable browsers (7)
            // Then we fail the request immediately
            if (!browsers || browsers.length === 7) {

                defer.reject();

            // I checked, and we're getting inside this else statement.
            } else {

                if (browsers.length !== 0) {

                    data = data.filter(filterData);

                }

                $timeout(resolveData, 650);

            }

            return defer.promise;

            function filterData(item) {

                return _.includes(browsers, item.browser);

            }

            function resolveData() {

                defer.resolve(data.value());

            }

        }

    }

})();
